import styles from "./FinishQuiz.module.css";
import clsx from "clsx";
import { QuizzesContext } from "../components/QuizzesContext";
import { useContext } from "react";
import { useNavigate, useParams } from "react-router-dom";
import { WindowSizeContext } from "../../Main_App/components/WindowSizeContext";

function FinishQuiz() {
  const { windowWidth } = useContext(WindowSizeContext);
  const { state } = useContext(QuizzesContext);
  const { id } = useParams();
  const navigate = useNavigate();

  const currentQuiz = state.quizzes.find((quiz) => quiz.id === id);
  const mins = Math.floor(state.timeSpent / 60);
  const secs = state.timeSpent % 60;
  const mobileView = windowWidth <= 500;

  const handleViewSolutionsBtn = () => {
    navigate("quizreview");
  };

  return (
    <div className={clsx(styles.finishQuizContainer)}>
      <div className={styles.layer}>
        <div className={styles.subContainer}>
          <div className={clsx(styles.trophyContainer)}>
            <svg
              width="55"
              height="54"
              viewBox="0 0 55 54"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M27.5 24.75C28.7604 24.75 29.8394 24.3094 30.737 23.4281C31.6346 22.5469 32.0833 21.4875 32.0833 20.25C32.0833 19.0125 31.6346 17.9531 30.737 17.0719C29.8394 16.1906 28.7604 15.75 27.5 15.75C26.2396 15.75 25.1606 16.1906 24.263 17.0719C23.3655 17.9531 22.9167 19.0125 22.9167 20.25C22.9167 21.4875 23.3655 22.5469 24.263 23.4281C25.1606 24.3094 26.2396 24.75 27.5 24.75ZM16.0417 47.25V42.75H25.2083V35.775C23.3368 35.3625 21.6658 34.5844 20.1953 33.4406C18.7248 32.2969 17.6458 30.8625 16.9583 29.1375C14.0938 28.8 11.697 27.5719 9.76823 25.4531C7.83941 23.3344 6.875 20.85 6.875 18V15.75C6.875 14.5125 7.32378 13.4531 8.22135 12.5719C9.11892 11.6906 10.1979 11.25 11.4583 11.25H16.0417V6.75H38.9583V11.25H43.5417C44.8021 11.25 45.8811 11.6906 46.7786 12.5719C47.6762 13.4531 48.125 14.5125 48.125 15.75V18C48.125 20.85 47.1606 23.3344 45.2318 25.4531C43.303 27.5719 40.9062 28.8 38.0417 29.1375C37.3542 30.8625 36.2752 32.2969 34.8047 33.4406C33.3342 34.5844 31.6632 35.3625 29.7917 35.775V42.75H38.9583V47.25H16.0417ZM16.0417 24.3V15.75H11.4583V18C11.4583 19.425 11.8785 20.7094 12.7188 21.8531C13.559 22.9969 14.6667 23.8125 16.0417 24.3ZM27.5 31.5C29.4097 31.5 31.033 30.8438 32.3698 29.5312C33.7066 28.2188 34.375 26.625 34.375 24.75V11.25H20.625V24.75C20.625 26.625 21.2934 28.2188 22.6302 29.5312C23.967 30.8438 25.5903 31.5 27.5 31.5ZM38.9583 24.3C40.3333 23.8125 41.441 22.9969 42.2812 21.8531C43.1215 20.7094 43.5417 19.425 43.5417 18V15.75H38.9583V24.3Z"
                fill="#4F46E5"
              />
            </svg>
          </div>
          <h1 className={clsx(styles.completedTitle)}>Quiz Completed!</h1>
          <p className={clsx(styles.completedDescription)}>
            Great job on finishing the {currentQuiz.title} quiz
          </p>
          <h2 className={clsx(styles.score)}>
            Score: {state.score}/{state.totalScore}
          </h2>
          <div className={styles.finishCardsContainer}>
            <FinishQuizCard
              value={`${mins < 10 ? `0${mins}` : mins}:${
                secs < 10 ? `0${secs}` : secs
              }`}
              cardText="Time Taken"
              svg={
                <svg
                  width="19"
                  height="19"
                  viewBox="0 0 19 19"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M12.1127 13.2208L13.221 12.1125L10.2918 9.18331V5.54165H8.7085V9.81665L12.1127 13.2208ZM9.50016 17.4166C8.40502 17.4166 7.37586 17.2088 6.41266 16.7932C5.44947 16.3776 4.61162 15.8135 3.89912 15.101C3.18662 14.3885 2.62256 13.5507 2.20693 12.5875C1.79131 11.6243 1.5835 10.5951 1.5835 9.49998C1.5835 8.40484 1.79131 7.37567 2.20693 6.41248C2.62256 5.44928 3.18662 4.61144 3.89912 3.89894C4.61162 3.18644 5.44947 2.62238 6.41266 2.20675C7.37586 1.79113 8.40502 1.58331 9.50016 1.58331C10.5953 1.58331 11.6245 1.79113 12.5877 2.20675C13.5509 2.62238 14.3887 3.18644 15.1012 3.89894C15.8137 4.61144 16.3778 5.44928 16.7934 6.41248C17.209 7.37567 17.4168 8.40484 17.4168 9.49998C17.4168 10.5951 17.209 11.6243 16.7934 12.5875C16.3778 13.5507 15.8137 14.3885 15.1012 15.101C14.3887 15.8135 13.5509 16.3776 12.5877 16.7932C11.6245 17.2088 10.5953 17.4166 9.50016 17.4166ZM9.50016 15.8333C11.255 15.8333 12.7493 15.2165 13.983 13.9828C15.2167 12.7491 15.8335 11.2548 15.8335 9.49998C15.8335 7.74512 15.2167 6.25085 13.983 5.01717C12.7493 3.78349 11.255 3.16665 9.50016 3.16665C7.7453 3.16665 6.25103 3.78349 5.01735 5.01717C3.78367 6.25085 3.16683 7.74512 3.16683 9.49998C3.16683 11.2548 3.78367 12.7491 5.01735 13.9828C6.25103 15.2165 7.7453 15.8333 9.50016 15.8333Z"
                    fill="#4F46E5"
                  />
                </svg>
              }
              svgBgColor="#DBEAFE"
              bgColor="#DBD9FF"
            />
            <FinishQuizCard
              value={state.correctAnswers.length}
              cardText="Correct Answers"
              svg={
                <svg
                  width="19"
                  height="19"
                  viewBox="0 0 19 19"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M8.39183 13.1416L13.9731 7.5604L12.8647 6.45206L8.39183 10.925L6.13558 8.66873L5.02725 9.77707L8.39183 13.1416ZM9.50016 17.4167C8.40502 17.4167 7.37586 17.2088 6.41266 16.7932C5.44947 16.3776 4.61162 15.8135 3.89912 15.101C3.18662 14.3885 2.62256 13.5507 2.20693 12.5875C1.79131 11.6243 1.5835 10.5951 1.5835 9.49998C1.5835 8.40484 1.79131 7.37568 2.20693 6.41248C2.62256 5.44929 3.18662 4.61144 3.89912 3.89894C4.61162 3.18644 5.44947 2.62238 6.41266 2.20675C7.37586 1.79113 8.40502 1.58331 9.50016 1.58331C10.5953 1.58331 11.6245 1.79113 12.5877 2.20675C13.5509 2.62238 14.3887 3.18644 15.1012 3.89894C15.8137 4.61144 16.3778 5.44929 16.7934 6.41248C17.209 7.37568 17.4168 8.40484 17.4168 9.49998C17.4168 10.5951 17.209 11.6243 16.7934 12.5875C16.3778 13.5507 15.8137 14.3885 15.1012 15.101C14.3887 15.8135 13.5509 16.3776 12.5877 16.7932C11.6245 17.2088 10.5953 17.4167 9.50016 17.4167ZM9.50016 15.8333C11.2682 15.8333 12.7658 15.2198 13.9929 13.9927C15.22 12.7656 15.8335 11.268 15.8335 9.49998C15.8335 7.73193 15.22 6.23436 13.9929 5.00727C12.7658 3.78019 11.2682 3.16665 9.50016 3.16665C7.73211 3.16665 6.23454 3.78019 5.00745 5.00727C3.78037 6.23436 3.16683 7.73193 3.16683 9.49998C3.16683 11.268 3.78037 12.7656 5.00745 13.9927C6.23454 15.2198 7.73211 15.8333 9.50016 15.8333Z"
                    fill="#22C55E"
                  />
                </svg>
              }
              svgBgColor="#8DFFB7"
              bgColor="#DBEAFE"
            />
            <FinishQuizCard
              value="80%"
              cardText="Accuracy"
              svg={
                <svg
                  width="19"
                  height="19"
                  viewBox="0 0 19 19"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M12.6665 15.8334V10.2917H15.8332V15.8334H12.6665ZM7.9165 15.8334V3.16669H11.0832V15.8334H7.9165ZM3.1665 15.8334V7.12502H6.33317V15.8334H3.1665Z"
                    fill="#EAC452"
                  />
                </svg>
              }
              svgBgColor="#F3E8FF"
              bgColor="#FFD7B5"
            />
          </div>
          <div className={styles.finishCardButtons}>
            <button
              onClick={handleViewSolutionsBtn}
              className={clsx(styles.viewSolutionsBtn)}
            >
              {!mobileView && (
                <span>
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M12 16C13.25 16 14.3125 15.5625 15.1875 14.6875C16.0625 13.8125 16.5 12.75 16.5 11.5C16.5 10.25 16.0625 9.1875 15.1875 8.3125C14.3125 7.4375 13.25 7 12 7C10.75 7 9.6875 7.4375 8.8125 8.3125C7.9375 9.1875 7.5 10.25 7.5 11.5C7.5 12.75 7.9375 13.8125 8.8125 14.6875C9.6875 15.5625 10.75 16 12 16ZM12 14.2C11.25 14.2 10.6125 13.9375 10.0875 13.4125C9.5625 12.8875 9.3 12.25 9.3 11.5C9.3 10.75 9.5625 10.1125 10.0875 9.5875C10.6125 9.0625 11.25 8.8 12 8.8C12.75 8.8 13.3875 9.0625 13.9125 9.5875C14.4375 10.1125 14.7 10.75 14.7 11.5C14.7 12.25 14.4375 12.8875 13.9125 13.4125C13.3875 13.9375 12.75 14.2 12 14.2ZM12 19C9.56667 19 7.35 18.3208 5.35 16.9625C3.35 15.6042 1.9 13.7833 1 11.5C1.9 9.21667 3.35 7.39583 5.35 6.0375C7.35 4.67917 9.56667 4 12 4C14.4333 4 16.65 4.67917 18.65 6.0375C20.65 7.39583 22.1 9.21667 23 11.5C22.1 13.7833 20.65 15.6042 18.65 16.9625C16.65 18.3208 14.4333 19 12 19ZM12 17C13.8833 17 15.6125 16.5042 17.1875 15.5125C18.7625 14.5208 19.9667 13.1833 20.8 11.5C19.9667 9.81667 18.7625 8.47917 17.1875 7.4875C15.6125 6.49583 13.8833 6 12 6C10.1167 6 8.3875 6.49583 6.8125 7.4875C5.2375 8.47917 4.03333 9.81667 3.2 11.5C4.03333 13.1833 5.2375 14.5208 6.8125 15.5125C8.3875 16.5042 10.1167 17 12 17Z"
                      fill="#F5F5F5"
                    />
                  </svg>
                </span>
              )}
              {`${mobileView ? "Solutions" : "View Solutions"}`}
            </button>
            <button className={clsx(styles.tryAgainBtn)}>
              {!mobileView && (
                <span>
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M5.1 16.05C4.73333 15.4167 4.45833 14.7667 4.275 14.1C4.09167 13.4333 4 12.75 4 12.05C4 9.81667 4.775 7.91667 6.325 6.35C7.875 4.78333 9.76667 4 12 4H12.175L10.575 2.4L11.975 1L15.975 5L11.975 9L10.575 7.6L12.175 6H12C10.3333 6 8.91667 6.5875 7.75 7.7625C6.58333 8.9375 6 10.3667 6 12.05C6 12.4833 6.05 12.9083 6.15 13.325C6.25 13.7417 6.4 14.15 6.6 14.55L5.1 16.05ZM12.025 23L8.025 19L12.025 15L13.425 16.4L11.825 18H12C13.6667 18 15.0833 17.4125 16.25 16.2375C17.4167 15.0625 18 13.6333 18 11.95C18 11.5167 17.95 11.0917 17.85 10.675C17.75 10.2583 17.6 9.85 17.4 9.45L18.9 7.95C19.2667 8.58333 19.5417 9.23333 19.725 9.9C19.9083 10.5667 20 11.25 20 11.95C20 14.1833 19.225 16.0833 17.675 17.65C16.125 19.2167 14.2333 20 12 20H11.825L13.425 21.6L12.025 23Z"
                      fill="black"
                      fillOpacity="0.7"
                    />
                  </svg>
                </span>
              )}
              Try Again
            </button>
            <button className={clsx(styles.backToHomeBtn)}>
              {!mobileView && (
                <span>
                  <svg
                    width="24"
                    height="24"
                    viewBox="0 0 24 24"
                    fill="none"
                    xmlns="http://www.w3.org/2000/svg"
                  >
                    <path
                      d="M6 19H9V13H15V19H18V10L12 5.5L6 10V19ZM4 21V9L12 3L20 9V21H13V15H11V21H4Z"
                      fill="black"
                      fill-opacity="0.7"
                    />
                  </svg>
                </span>
              )}
              {`${mobileView ? "Home" : "Back to Home"}`}
            </button>
          </div>
        </div>
      </div>
    </div>
  );
}

export function FinishQuizCard({ value, cardText, svg, bgColor, svgBgColor }) {
  return (
    <div style={{ backgroundColor: bgColor }} className={styles.finishQuizCard}>
      <div
        style={{ backgroundColor: svgBgColor }}
        className={styles.finishQuizCardSvgContainer}
      >
        {svg}
      </div>
      <p className={clsx(styles.finishCardText)}>{cardText}</p>
      <h3 className={clsx(styles.finishCardValue)}>{value}</h3>
    </div>
  );
}

export default FinishQuiz;
